<div class="app">
  <main class="content">
    <header class="header">
      <h1><i class="fas fa-santa"></i> Espace Secret : {{ isGiver() ? 'Cadeau pour ' + targetName() : 'Mon Père Noël' }}</h1>
    </header>

    <div class="santa-grid">
      
      <section class="chat-section card">
        <div class="chat-header">
          <h3><i class="fas fa-comments"></i> Discussion anonyme</h3>
          <small>{{ isGiver() ? 'Posez des questions sans vous dévoiler' : 'Répondez à votre Père Noël' }}</small>
        </div>

        <div class="messages-container">
          @for (msg of messages(); track msg.id) {
            <div class="message" [ngClass]="{'mine': msg.senderId === userId, 'others': msg.senderId !== userId}">
              <div class="bubble">
                <span class="sender-label">
                  {{ msg.senderId === userId ? 'Moi' : (isGiver() ? targetName() : 'Père Noël Secret') }}
                </span>
                <p>{{ msg.content }}</p>
                <small>{{ msg.sentAt | date:'HH:mm' }}</small>
              </div>
            </div>
          }
        </div>

        <div class="chat-input">
          <input type="text" [(ngModel)]="newMessage" placeholder="Écrire un message..." (keyup.enter)="sendMessage()">
          <button (click)="sendMessage()" class="btn-send"><i class="fas fa-paper-plane"></i></button>
        </div>
      </section>

      <section class="wishlist-section card">
        <h3><i class="fas fa-gift"></i> Idées cadeaux</h3>
        
        @if (isGiver()) {
          <div class="wishlist-display">
            <p>Voici ce que <strong>{{ targetName() }}</strong> aimerait :</p>
            <div class="wishlist-content">
              {{ wishlist() || 'Aucune idée pour le moment...' }}
            </div>
          </div>
        } @else {
          <div class="wishlist-edit">
            <label>Aidez votre Père Noël en listant vos envies :</label>
            <textarea [(ngModel)]="wishlist" placeholder="Ex: Un livre de cuisine, une plante..."></textarea>
            <button class="btn-primary" (click)="updateWishlist()">
              <i class="fas fa-save"></i> Enregistrer mes envies
            </button>
          </div>
        }
      </section>

    </div>
  </main>
</div>